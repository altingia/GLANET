/**
 * @author Burcak Otlu
 * Sep 24, 2013
 * 1:18:27 PM
 * 2013
 *
 * 
 */
package augmentation.humangenes;

import java.io.BufferedReader;
import java.io.FileNotFoundException;
import java.io.FileReader;
import java.io.IOException;
import java.util.ArrayList;
import java.util.HashMap;
import java.util.List;
import java.util.Map;
import ui.GlanetRunner;
import common.Commons;


public class HumanGenesAugmentation {
	
	public static void fillHumanGeneId2ListofRefSeqRNANucleotideAccessionMap(String dataFolder,Map<String,List<String>> humanGeneId2ListofRefSeqRNANucleotideAccessionMap){
		FileReader fileReader;
		BufferedReader bufferedReader;
		String strLine;
		
		int indexofFirstTab;
		int indexofSecondTab;
		int indexofThirdTab;
		int indexofFourthTab;
		
		int indexofDot;
		
		String geneId;
		String RNANucleotideAccessionWithVersion;
		String RNANucleotideAccession;

		List<String> refSeqRNANucleotideAccessionList;
		
		try {
			fileReader =  new FileReader(dataFolder + Commons.NCBI_HUMAN_GENE_TO_REF_SEQ_DIRECTORYNAME + Commons.NCBI_HUMAN_GENE_TO_REF_SEQ_FILENAME);
			bufferedReader = new BufferedReader(fileReader);
			
			while((strLine = bufferedReader.readLine())!=null) {
				//example line
				//the second column is gene id column
				//the fourth column is the refseq gene name column
				//9606	63976	REVIEWED	NM_022114.3	289547572	NP_071397.3	289547573	NC_000001.10	224589800	2985741	3355184	+	Reference GRCh37.p10 Primary Assembly
				indexofFirstTab = strLine.indexOf('\t');
				indexofSecondTab = strLine.indexOf('\t',indexofFirstTab+1);
				indexofThirdTab = strLine.indexOf('\t',indexofSecondTab+1);
				indexofFourthTab = strLine.indexOf('\t',indexofThirdTab+1);

				geneId = strLine.substring(indexofFirstTab+1,indexofSecondTab);
				
				//RNA nucleotide accession.version:	may be null (-) for some genomes
				RNANucleotideAccessionWithVersion = strLine.substring(indexofThirdTab+1,indexofFourthTab);
				
				indexofDot = RNANucleotideAccessionWithVersion.indexOf('.');
				
				RNANucleotideAccession =  null;
				
				if (indexofDot>= 0){
					RNANucleotideAccession = RNANucleotideAccessionWithVersion.substring(0,indexofDot);
				}
				
				refSeqRNANucleotideAccessionList =humanGeneId2ListofRefSeqRNANucleotideAccessionMap.get(geneId);
				
				if (!RNANucleotideAccessionWithVersion.equals("-")){
					if(refSeqRNANucleotideAccessionList==null){
						refSeqRNANucleotideAccessionList = new ArrayList<String>();
						
						if(RNANucleotideAccession!=null){
							refSeqRNANucleotideAccessionList.add(RNANucleotideAccession);	
						}
						
						humanGeneId2ListofRefSeqRNANucleotideAccessionMap.put(geneId, refSeqRNANucleotideAccessionList);
						
					}else{
						if (RNANucleotideAccession!=null && !refSeqRNANucleotideAccessionList.contains(RNANucleotideAccession)){
							refSeqRNANucleotideAccessionList.add(RNANucleotideAccession);	
						}
						
						humanGeneId2ListofRefSeqRNANucleotideAccessionMap.put(geneId, refSeqRNANucleotideAccessionList);
						
					}
				}
				
			}//End of while
			
			bufferedReader.close();
			
		} catch (FileNotFoundException e) {
			e.printStackTrace();
		} catch (IOException e) {
			e.printStackTrace();
		}
		
	}
	
	
	public static void fillHumanRefSeqRNANucleotideAccession2ListofAlternateGeneNameMap(String dataFolder,Map<String,List<String>> humanRefSeqRNANucleotideAccession2ListofAlternateGeneNameMap){
		
		FileReader fileReader;
		BufferedReader bufferedReader;
		String strLine;
		
		int indexofFirstTab;
		int indexofSecondTab;
		int indexofThirdTab;
		int indexofFourthTab;
		int indexofFifthTab;
		int indexofSixthTab;
		int indexofSeventhTab;
		int indexofEighthTab;
		int indexofNinethTab;
		int indexofTenthTab;
		int indexofEleventhTab;
		int indexofTwelfthTab;
		int indexofThirteenthTab;
		
		String refSeqRNANucleotideAccession;
		String alternateGeneName;
		
		List<String> alternateGeneNameList;
		
		
		
		try {
			fileReader = new FileReader(dataFolder + Commons.FTP_HG19_REFSEQ_GENES);
			bufferedReader = new BufferedReader(fileReader);
			
			//skip header line
			strLine = bufferedReader.readLine();
			
			while((strLine = bufferedReader.readLine())!=null) {
				//header line
				//#bin	name	chrom	strand	txStart	txEnd	cdsStart	cdsEnd	exonCount	exonStarts	exonEnds	score	name2	cdsStartStat	cdsEndStat	exonFrames
				//example line
				//0	NM_032291	chr1	+	66999824	67210768	67000041	67208778	25	66999824,67091529,67098752,67101626,67105459,67108492,67109226,67126195,67133212,67136677,67137626,67138963,67142686,67145360,67147551,67154830,67155872,67161116,67184976,67194946,67199430,67205017,67206340,67206954,67208755,	67000051,67091593,67098777,67101698,67105516,67108547,67109402,67126207,67133224,67136702,67137678,67139049,67142779,67145435,67148052,67154958,67155999,67161176,67185088,67195102,67199563,67205220,67206405,67207119,67210768,	0	SGIP1	cmpl	cmpl	0,1,2,0,0,0,1,0,0,0,1,2,1,1,1,1,0,1,1,2,2,0,2,1,1,
				
				indexofFirstTab = strLine.indexOf('\t');
				indexofSecondTab = strLine.indexOf('\t',indexofFirstTab+1);
				indexofThirdTab = strLine.indexOf('\t',indexofSecondTab+1);
				indexofFourthTab = strLine.indexOf('\t',indexofThirdTab+1);
				indexofFifthTab = strLine.indexOf('\t',indexofFourthTab+1);
				indexofSixthTab = strLine.indexOf('\t',indexofFifthTab+1);
				indexofSeventhTab = strLine.indexOf('\t',indexofSixthTab+1);
				indexofEighthTab = strLine.indexOf('\t',indexofSeventhTab+1);
				indexofNinethTab = strLine.indexOf('\t',indexofEighthTab+1);
				indexofTenthTab = strLine.indexOf('\t',indexofNinethTab+1);
				indexofEleventhTab = strLine.indexOf('\t',indexofTenthTab+1);
				indexofTwelfthTab = strLine.indexOf('\t',indexofEleventhTab+1);
				indexofThirteenthTab = strLine.indexOf('\t',indexofTwelfthTab+1);
				
				refSeqRNANucleotideAccession = strLine.substring(indexofFirstTab+1, indexofSecondTab);
				alternateGeneName = strLine.substring(indexofTwelfthTab+1, indexofThirteenthTab);
				
				alternateGeneNameList = humanRefSeqRNANucleotideAccession2ListofAlternateGeneNameMap.get(refSeqRNANucleotideAccession);
				
				if (alternateGeneNameList == null){
					alternateGeneNameList = new ArrayList<String>();
					alternateGeneNameList.add(alternateGeneName);
					
					humanRefSeqRNANucleotideAccession2ListofAlternateGeneNameMap.put(refSeqRNANucleotideAccession,alternateGeneNameList);
				} else{
					if (!alternateGeneNameList.contains(alternateGeneName)){
						alternateGeneNameList.add(alternateGeneName);
						System.out.println("size of alternateGeneNameList: " + alternateGeneNameList.size());
					}
					humanRefSeqRNANucleotideAccession2ListofAlternateGeneNameMap.put(refSeqRNANucleotideAccession,alternateGeneNameList);
					
				}
				
			}//End of WHILE
			
			bufferedReader.close();
			
		} catch (FileNotFoundException e) {
				e.printStackTrace();
		} catch (IOException e) {
			e.printStackTrace();
		}
	}
	
	public static void augmentGeneIdWithRefSeqRNANucleotideAccession(List<String> keggPathwayGeneIdList, List<String>  keggPathwayRefSeqRNANucleotideAccessionList,Map<String,List<String>> humanGeneId2ListofRefSeqRNANucleotideAccessionMap){
		List<String> refSeqRNANucleotideAccessionList;
		
		
		for(String geneId: keggPathwayGeneIdList) {
			refSeqRNANucleotideAccessionList = humanGeneId2ListofRefSeqRNANucleotideAccessionMap.get(geneId);
			
			if (refSeqRNANucleotideAccessionList!=null){
				for(String refSeqRNANucleotideAccession: refSeqRNANucleotideAccessionList){
					if (!keggPathwayRefSeqRNANucleotideAccessionList.contains(refSeqRNANucleotideAccession)){
						keggPathwayRefSeqRNANucleotideAccessionList.add(refSeqRNANucleotideAccession);
					}
				}
			}
		}
		
		
	}
	
	public static void augmentRefSeqRNANucleotideAccessionwithAlternateGeneName(List<String> keggPathwayRefSeqRNANucleotideAccessionList, List<String> keggPathwayAlternateGeneNameList,Map<String,List<String>> humanRefSeqRNANucleotideAccession2ListofAlternateGeneNameMap){
		List<String> alternateGeneNameList;
		
		for(String refSeqRNANucleotideAccession: keggPathwayRefSeqRNANucleotideAccessionList){
			alternateGeneNameList = humanRefSeqRNANucleotideAccession2ListofAlternateGeneNameMap.get(refSeqRNANucleotideAccession);
			
			if (alternateGeneNameList!=null){
				for(String alternateGeneName: alternateGeneNameList){
					if (!keggPathwayAlternateGeneNameList.contains(alternateGeneName)){
						keggPathwayAlternateGeneNameList.add(alternateGeneName);
					}
				}
			}
			
		}
	}
	

	/**
	 * 
	 */
	public HumanGenesAugmentation() {
		// TODO Auto-generated constructor stub
	}

	
	//args[0] must have input file name with folder
	//args[1] must have GLANET installation folder with "\\" at the end. This folder will be used for outputFolder and dataFolder.
	//args[2] must have Input File Format		
	//args[3] must have Number of Permutations	
	//args[4] must have False Discovery Rate (ex: 0.05)
	//args[5] must have Generate Random Data Mode (with GC and Mapability/without GC and Mapability)
	//args[6] must have writeGeneratedRandomDataMode checkBox
	//args[7] must have writePermutationBasedandParametricBasedAnnotationResultMode checkBox
	//args[8] must have writePermutationBasedAnnotationResultMode checkBox
	//args[9] must have Dnase Enrichment example: DO_DNASE_ENRICHMENT or DO_NOT_DNASE_ENRICHMENT
	//args[10] must have Histone Enrichment example : DO_HISTONE_ENRICHMENT or DO_NOT_HISTONE_ENRICHMENT
	//args[11] must have Tf and KeggPathway Enrichment example: DO_TF_KEGGPATHWAY_ENRICHMENT or DO_NOT_TF_KEGGPATHWAY_ENRICHMENT
	//args[12] must have Tf and CellLine and KeggPathway Enrichment example: DO_TF_CELLLINE_KEGGPATHWAY_ENRICHMENT or DO_NOT_TF_CELLLINE_KEGGPATHWAY_ENRICHMENT
	//args[13] must have a job name exampe: any_string 
	public static void main(String[] args) {
		
		String glanetFolder = args[1];
		String dataFolder 	= glanetFolder + System.getProperty("file.separator") + Commons.DATA + System.getProperty("file.separator") ;
//		String outputFolder = glanetFolder + System.getProperty("file.separator") + Commons.OUTPUT + System.getProperty("file.separator") ;

		
		// for testing purposes
		Map<String,List<String>> humanGeneId2ListofRefSeqRNANucleotideAccessionMap = new HashMap<String, List<String>>();
		fillHumanGeneId2ListofRefSeqRNANucleotideAccessionMap(dataFolder,humanGeneId2ListofRefSeqRNANucleotideAccessionMap);
		
		Map<String,List<String>> humanRefSeqRNANucleotideAccession2ListofAlternateGeneNameMap = new HashMap<String,List<String>>();
		fillHumanRefSeqRNANucleotideAccession2ListofAlternateGeneNameMap(dataFolder,humanRefSeqRNANucleotideAccession2ListofAlternateGeneNameMap);
		
		
		List<String> keggPathwayGeneIdList = new ArrayList<String>();
		keggPathwayGeneIdList.add("10000");
		keggPathwayGeneIdList.add("1050");
		keggPathwayGeneIdList.add("11040");
		keggPathwayGeneIdList.add("1147");
		keggPathwayGeneIdList.add("1978");
		keggPathwayGeneIdList.add("207");
		keggPathwayGeneIdList.add("208");
		keggPathwayGeneIdList.add("2322");
		keggPathwayGeneIdList.add("23533");
		
		List<String>  keggPathwayRefSeqRNANucleotideAccessionList =  new ArrayList<String>();
		List<String>  keggPathwayAlternateGeneNameList =  new ArrayList<String>();
		
		
		augmentGeneIdWithRefSeqRNANucleotideAccession(keggPathwayGeneIdList, keggPathwayRefSeqRNANucleotideAccessionList,humanGeneId2ListofRefSeqRNANucleotideAccessionMap);		
		augmentRefSeqRNANucleotideAccessionwithAlternateGeneName(keggPathwayRefSeqRNANucleotideAccessionList, keggPathwayAlternateGeneNameList, humanRefSeqRNANucleotideAccession2ListofAlternateGeneNameMap);
		
		
	}

}
